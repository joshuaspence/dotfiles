#!/bin/bash

#/
## Creates a data URL from a file or from piped input.
#\

#| Usage: data-url [<file>]
#|
#| Creates a data URL from a file or from piped input.

set -e

function usage() {
    cat "$0" |
    grep '^#|' |
    cut -c4-
}

if [[ $# > 0 && ( "$1" == '-h' || "$1" == '--help' ) ]]; then
    usage
    exit 0
fi

if [[ ! -p /dev/stdin && $# == 0 ]]; then
    usage
    exit 1
fi

mime=$(mimetype -b $(test -p /dev/stdin && echo '--stdin' || echo "$1"))
if [[ $mime == text/* ]]; then
    mime="${mime};charset=utf-8"
fi

echo -n "data:${mime};base64,$(openssl base64 $(test -p /dev/stdin || echo "-in $1") | tr -d '\n')"

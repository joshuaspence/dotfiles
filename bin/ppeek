#!/bin/bash

#/
## Read lines from standard input and write to both standard output and standard
## error. This is useful for peeking in on a pipeline.
##
## @param [optional, String] Text to prefix standard error output.
#\

#| Usage: ppeek [<prefix>]
#|
#| Read lines from standard input and write to both standard output and standard
#| error. This is useful for peeking in on a pipeline.

set -e

function usage() {
    cat "$0" |
    grep '^#|' |
    cut -c4-
}

if [[ $# > 0 && ( "$1" == '-h' || "$1" == '--help' ) ]]; then
    usage
    exit 0
fi

prefix="${1:-> }"

while read -r line; do
    echo "${line}"
    echo "${prefix}${line}" 1>&2
done

exit 0

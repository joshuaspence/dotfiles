#!/usr/bin/env aptfile

export DEBIAN_FRONTEND=noninteractive

CODENAME=$(lsb_release --codename --short)
KEYRINGS="/etc/apt/keyrings"

function repository_key() {
  local keyring="${KEYRINGS}/${1}.gpg"
  test -f "${keyring}" || curl --fail --location --show-error --silent "${2}" | gpg --dearmor --output "${keyring}"
}

repository_key "docker" "https://download.docker.com/linux/ubuntu/gpg"
repository_file "docker" "deb [arch=amd64 signed-by=${KEYRINGS}/docker.gpg] https://download.docker.com/linux/ubuntu ${CODENAME} stable"

repository_key "dropbox" "https://linux.dropbox.com/fedora/rpm-public-key.asc"
repository_file "dropbox" "deb [arch=i386,amd64 signed-by=${KEYRINGS}/dropbox.gpg] https://linux.dropbox.com/ubuntu disco main"

repository_key "github-cli" "https://cli.github.com/packages/githubcli-archive-keyring.gpg"
repository_file "github-cli" "deb [arch=amd64 signed-by=${KEYRINGS}/github-cli.gpg] https://cli.github.com/packages stable main"

repository_key "google-chrome" "https://dl.google.com/linux/linux_signing_key.pub"
repository_file "google-chrome" "deb [arch=amd64 signed-by=${KEYRINGS}/google-chrome.gpg] http://dl.google.com/linux/chrome/deb/ stable main"

repository_key "hashicorp" "https://apt.releases.hashicorp.com/gpg"
repository_file "hashicorp" "deb [arch=amd64 signed-by=${KEYRINGS}/hashicorp.gpg] https://apt.releases.hashicorp.com ${CODENAME} main"

repository_key "slack" "https://packagecloud.io/slacktechnologies/slack/gpgkey"
repository_file "slack" "deb [signed-by=${KEYRINGS}/slack.gpg] https://packagecloud.io/slacktechnologies/slack/debian/ jessie main"

repository_key "speedtest-cli" "https://packagecloud.io/ookla/speedtest-cli/gpgkey"
repository_file "speedtest-cli" "deb [signed-by=${KEYRINGS}/speedtest-cli.gpg] https://packagecloud.io/ookla/speedtest-cli/ubuntu/ focal main"

repository_key "microsoft" "https://packages.microsoft.com/keys/microsoft.asc"
repository_file "vscode" "deb [arch=amd64,arm64,armhf signed-by=${KEYRINGS}/microsoft.gpg] https://packages.microsoft.com/repos/code stable main"

update

packagelist "apt-file" "synaptic"
package "awscli"
package "build-essential"
package "code"
packagelist "curl" "wget"
packagelist "dconf-editor" "libglib2.0-bin"
packagelist "docker-ce" "docker-ce-cli"
package "dropbox"
package "fzf"
package "gawk"
package "gh"
package "gimp"
packagelist "git" "git-crypt" "git-lfs"
package "google-chrome-stable"
package "gpg"
packagelist "htop" "iftop" "powerstat"
package "jq"
package "less"
packagelist "libcairo2-dev" "libgirepository1.0-dev" "python3-gi" # for `pygobject`
package "moreutils"
packagelist "bind9-dnsutils" "netcat-openbsd" "netstat-nat" "whois"
packagelist "network-manager-l2tp" "network-manager-openconnect" "network-manager-openconnect-gnome"
packagelist "nmap" "traceroute"
packagelist "packer" "terraform"
packagelist "parallel" "retry"
packagelist "python3" "python3-dev" "python3-venv"
package "qemu-user-static"
package "slack-desktop"
package "speedtest"
packagelist "rsync" "ssh-client"
package "synaptic"
package "terminator"
package "tree"
package "vim"
package "xclip"
